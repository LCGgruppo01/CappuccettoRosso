
game.healthText(player)<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Phaser Game!</title>
        <script src="http://cdn.jsdelivr.net/phaser/2.5.0/phaser.min.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        // Phaser code here! :)
        /**
         * Generated from the Phaser Sandbox
         *
         * //phaser.io/sandbox/NynQHaDE
         *
         * This source requires Phaser 2.6.2
         */

        var game = new Phaser.Game(1350, 640, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });

        var openImage;
        var time=0;
        var salto=0;
        var platformLenght = 500;
        var platformHeight = 64;
        var backgroundWidth = 800;
        var timeWolves = 0;

        function preload() {

        }

        var StartState = {
            preload: function() {
                game.load.crossOrigin = 'anonymous';
                game.load.image('open', 'http://1.bp.blogspot.com/-a8aV13i0t9Y/Vi4LTodbxuI/AAAAAAAABdM/YPArwcG7Gx8/s1600/cappuccetto-rosso-e-il-lupo.jpg');
            },

            create: function() {
                image = game.add.sprite(game.world.centerX, game.world.centerY, 'open');
                image.scale.setTo(0.6,0.6);
                image.anchor.set(0.5);
                image.inputEnabled = true;
                image.events.onInputDown.add(this.imageClick, this);
                scoreCandies = 10;
                scoreToothbrushes = 10;
                jump = 200;

            },

            imageClick: function(pointer) {
                this.game.state.start('Game1');
            }

        }

        game.state.add('Start', StartState);

        var Game1State = {
            preload: function() {

                game.world.width=1350;


                game.load.crossOrigin = 'anonymous';


                game.load.baseURL = 'http://examples.phaser.io/assets/';

                game.load.image('bullet', 'bullets/bullet13.png');
                game.load.spritesheet('wolf', 'https://raw.githubusercontent.com/LCGgruppo01/CappuccettoRosso/master/imgs/wolf_430x498.png', 430, 498);
                game.load.image('sky', 'skies/sky2.png');
                game.load.image('ground', 'sprites/platform.png');
                game.load.image('thorns', 'https://raw.githubusercontent.com/LCGgruppo01/CappuccettoRosso/master/imgs/thorns.png');
                game.load.spritesheet('granny', 'https://raw.githubusercontent.com/LCGgruppo01/CappuccettoRosso/master/imgs/granny_369x432.png', 369, 432);
            },

            create: function() {
                game.world.setBounds(0, 0, game.world.width*2, game.world.height);
                game.physics.startSystem(Phaser.Physics.ARCADE);

                Backgrounds = game.add.group();
                for (i = 0; i < game.world.width / backgroundWidth; i++) {
                  var background = Backgrounds.create(i * backgroundWidth, 0, 'sky');
                };

                platforms = game.add.group();
                platforms.enableBody = true;
                for (i = 0; i < game.world.width / platformLenght; i++) {
                  var ground = platforms.create(i * platformLenght, game.world.height - platformHeight, 'ground');
                  ground.body.immovable = true;
                };

                var ledge =  platforms.create(game.world.width*0.1, game.world.height-100, 'ground');
                ledge.scale.setTo(0.5, 1.2);
                ledge.body.immovable = true;
                ledge = platforms.create(game.world.width*0.25, game.world.height-100, 'ground');
                ledge.scale.setTo(0.5, 1.2);
                ledge.body.immovable = true;

                player = game.add.sprite(32, game.world.height - 200, 'granny');
                player.frame = 1;
                game.physics.arcade.enable(player);
                player.scale.setTo(0.2, 0.2);
                player.body.bounce.y = 0.2;
                player.body.gravity.y = 500;
                player.body.collideWorldBounds = true;
                game.camera.follow(player);
                var position="rightt";
                player.health=100;
                player.maxHealth=100;
                player.heal(100);

                thorns = game.add.group();
                thorns.enableBody = true;
                var thorn = thorns.create(game.world.width*0.195, game.world.height-100, 'thorns');
                thorn.scale.setTo(0.7, 0.7);


                cursors = game.input.keyboard.createCursorKeys();
                SPACE=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);


                Wolves = game.add.group();
                Wolves.enableBody = true;
                var wolf = Wolves.create(1300,  game.world.height - 200, 'wolf');
                wolf.body.gravity.y = 500;
                wolf.body.bounce.y =0.2;
                wolf.scale.setTo(0.2, 0.2);


                Bullets = game.add.group();
                Bullets.enableBody = true;

              healthText = game.add.text(32, 32, 'health: 100', { fontSize: '50px', fill: 'rgb(255, 255, 255)' });
              healthText.fixedToCamera = true;
            },



            update: function() {
                var hitPlatform = game.physics.arcade.collide(player, platforms);
                game.physics.arcade.collide(Wolves, platforms);
                game.physics.arcade.overlap(Bullets, platforms, this.elide, null, this);
                game.physics.arcade.overlap(player, thorns, this.thornHit, null, this);
                game.physics.arcade.overlap(player, Wolves, this.wolfHit, null, this);
                game.physics.arcade.overlap(Bullets, Wolves, this.killWolves, null, this);

                player.body.velocity.x = player.body.velocity.x*0.87;

                healthText.text='Health: ' + player.health;

                if (cursors.left.isDown)
                {
                    player.body.velocity.x = -250;
                    position="leftt";
                    player.frame=0;
                }
                else if (cursors.right.isDown)
                {
                    player.body.velocity.x = 250;
                    position="rightt";
                    player.frame=1;
                }

                if (cursors.up.isDown && player.body.touching.down && hitPlatform)
                {
                    player.body.velocity.y = -300;
                    salto=1;

                }

                if (cursors.up.isUp && salto==1)
                {
                    salto=2;
                }

                if (cursors.up.isDown && salto==2)
                {
                    player.body.velocity.y = -250;
                    salto=3;
                }
                if (SPACE.isDown && position=="leftt" && game.time.now>time)
                {
                    var bullet = Bullets.create(player.x -10, player.y +20, 'bullet');
                    bullet.body.gravity.y = 400;
                    bullet.body.velocity.y = -100;
                    bullet.body.velocity.x = -400;
                    time=game.time.now+300;

                }
                else if (SPACE.isDown && position=="rightt" && game.time.now>time)
                {
                    bullet = Bullets.create(player.x +10, player.y +20, 'bullet');
                    bullet.body.gravity.y = 400;
                    bullet.body.velocity.y = -100;
                    bullet.body.velocity.x = 400;
                    time=game.time.now+300;

                }

                if ( game.time.now > timeWolves){
                  var wolf = Wolves.create(1300,  game.world.height - 200, 'wolf');
                  wolf.body.gravity.y = 500;
                  wolf.body.bounce.y =0.2;
                  wolf.scale.setTo(0.2, 0.2);
                  timeWolves = game.time.now + 4000;
                }

                Wolves.forEach(function(wolf){
                 if(Math.abs(player.x - wolf.x) < 600){
                   wolf.body.velocity.x = (player.x - wolf.x)/Math.abs(player.x - wolf.x)*50;
                 }
                 else{
                   wolf.body.velocity.x = 0;
                 }
                 if (wolf.body.touching.down && player.body.touching.down && Math.abs(player.x - wolf.x) < 250) {
                   if(wolf.y - player.y > 15){
                   wolf.body.velocity.y = -250;
                   }
                   else{
                   wolf.body.velocity.y = 0;
                   }
                 }
                 if (wolf.body.touching.left || wolf.body.touching.right && wolf.body.touching.down){
                   wolf.body.velocity.y = -250;
                 }
               });

              if(player.health <= 0)
              {
                this.game.state.start('Game1');
              }

            },


            elide: function (siElide, rimane) {
                siElide.kill();
            },
            thornHit: function (player, thorn) {
                player.body.velocity.y=-400;
                player.damage(25);
            },
            wolfHit: function (player, wolf) {
                player.body.velocity.x=-400;
                player.damage(25);
            },

            killWolves: function (bul, wol) {
                wol.kill();
                bul.kill();
            }
        }

        game.state.add('Game1', Game1State);

        var GoodState = {
            preload: function() {
                game.load.crossOrigin = 'anonymous';
                game.load.image('open', 'https://img.freepik.com/free-vector/clean-tooth-background_1270-86.jpg?size=338&ext=jpg');
            },

            create: function() {
                game.world.setBounds(0, 0, game.world.width*0.5, game.world.height);
                image = game.add.sprite(game.world.centerX, game.world.centerY, 'open');
                image.anchor.set(0.5);
                image.inputEnabled = true;
                image.events.onInputDown.add(this.imageClick, this);
            },

            imageClick: function(pointer) {
                this.game.state.start('Start');
            }

        }

        game.state.add('Good', GoodState);

        game.state.add('Game1', Game1State);

        var BadState = {
            preload: function() {
                game.load.crossOrigin = 'anonymous';
                game.load.image('open', 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTy0kSXXPUNRgkBb4PI0wAHSon2mSo2Xj6oojXZ90NZIIBAKIc6');
            },

            create: function() {
                game.world.setBounds(0, 0, game.world.width*0.5, game.world.height);
                image = game.add.sprite(game.world.centerX, game.world.centerY, 'open');
                image.anchor.set(0.5);
                image.inputEnabled = true;
                image.events.onInputDown.add(this.imageClick, this);
            },

            imageClick: function(pointer) {
                this.game.state.start('Start');
            }

        }

        game.state.add('Bad', BadState);

        // start the boot state
        game.state.start('Start');

        function create() {

        }

        function update () {

        }

        function render () {

        }


    }

    </script>

    </body>
</html>
